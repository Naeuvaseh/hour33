<ActionBar class="action-bar" 
           [backgroundColor]="theme.darkGrey"
           [color]="theme.actionBarTextColor">
    <Label class="action-bar-title" [text]="title"></Label>
    <ActionItem (tap)="onFilter()"
                icon="res://filter"
                height="50%"
                width="50%"></ActionItem>
    <!-- <ActionItem [visibility]="listViewVisible ? 'visible' : 'collapsed'"
                (tap)="onListMapToggle()"
                icon="res://location"
                android.position="actionBar"></ActionItem>
    <ActionItem [visibility]="!listViewVisible ? 'visible' : 'collapsed'"
                (tap)="onListMapToggle()"
                icon="res://beenhere"
                android.position="actionBar"></ActionItem> -->
</ActionBar>
<!-- Loading Inidicator -->
<FlexboxLayout 
    [visibility]="(loadingFlag) ? 'visible' : 'collapsed'"
    [backgroundColor]="theme.primaryColor"
    height="100%"
    width="100%"
    alignItems="center">
    <FlexboxLayout 
        width="100%"
        alignItems="center"
        flexDirection="column">
        <ActivityIndicator 
            busy="true" 
            width="100" 
            height="100" 
            [color]="theme.accentColor"
            class="activity-indicator"></ActivityIndicator>
    </FlexboxLayout>
</FlexboxLayout>
<!-- Zero Results/Not Found Display -->
<FlexboxLayout 
    [visibility]="(searchStatusCode == 'ZERO_RESULTS' || searchStatusCode == 'NOT_FOUND') ? 'visible' : 'collapsed'"
    [backgroundColor]="theme.primaryColor"
    height="100%"
    width="100%"
    alignItems="center">
    <FlexboxLayout 
        width="100%"
        alignItems="center"
        flexDirection="column">
        <Label 
            text="No Results Found"
            fontSize="36"
            [color]="theme.accentColor"></Label>
        <Button 
            text="Refresh"
            fontSize="16"
            padding="20"
            margin="50"
            (tap)="refresh($event, 0)"
            class="btn btn-primary"></Button>
    </FlexboxLayout>
</FlexboxLayout>
<!-- Other Error Display -->
<FlexboxLayout 
    [visibility]="(searchStatusCode != 'ZERO_RESULTS' && searchStatusCode != 'OK') ? 'visible' : 'collapsed'"
    [backgroundColor]="theme.primaryColor"
    height="100%"
    width="100%"
    alignItems="center">
    <FlexboxLayout 
        width="100%"
        alignItems="center"
        flexDirection="column">
        <!-- OVER_QUERY_LIMIT -->
        <FlexboxLayout 
            flexDirection="row"
            [visibility]="searchStatusCode == 'OVER_QUERY_LIMIT' ? 'visible' : 'collapsed'">
            <Label 
                text="Too many requests have been made. Try again tomorrow."
                fontSize="36"
                [color]="theme.accentColor"></Label>
        </FlexboxLayout>
        <!-- REQUEST_DENIED -->
        <FlexboxLayout 
            flexDirection="row"
            [visibility]="searchStatusCode == 'REQUEST_DENIED' ? 'visible' : 'collapsed'">
            <Label 
                text="Too many requests have been made. Try again tomorrow."
                fontSize="36"
                [color]="theme.accentColor"></Label>
        </FlexboxLayout>
        <!-- INVALID_REQUEST -->
        <FlexboxLayout 
            flexDirection="row"
            [visibility]="searchStatusCode == 'INVALID_REQUEST' ? 'visible' : 'collapsed'">
            <Label 
                text="Your request is invalid. Please try again."
                fontSize="36"
                [color]="theme.accentColor"></Label>
            <Button 
                text="Retry"
                fontSize="16"
                padding="20"
                margin="50"
                (tap)="refresh($event, 0)"
                class="btn btn-primary"></Button>
        </FlexboxLayout>
        <!-- UNKNOWN_ERROR -->
        <FlexboxLayout 
            flexDirection="row"
            [visibility]="searchStatusCode == 'UNKNOWN_ERROR' ? 'visible' : 'collapsed'">
            <Label 
                text="An unknown error has occurred. Please try again."
                fontSize="36"
                [color]="theme.accentColor"></Label>
            <Button 
                text="Retry"
                fontSize="16"
                padding="20"
                margin="50"
                (tap)="refresh($event, 0)"
                class="btn btn-primary"></Button>
        </FlexboxLayout>
    </FlexboxLayout>
</FlexboxLayout>
<!-- Filter Menu -->
<AbsoluteLayout
    #filterMenu
    [visibility]="filterMenuVisible ? 'visible' : 'collapsed'"
    width="100%"
    height="100%"
    [backgroundColor]="theme.primaryColor">
    <GridLayout 
        left="0" top="0"
        rows="9*, 1*" columns="*, *, *"
        width="100%" height="100%">
        <ScrollView 
            row="0"
            col="0"
            colSpan="3"
            width="100%" 
            padding="10"
            orientation="vertical" 
            [backgroundColor]="theme.primaryColor">            
            <GridLayout 
                left="0"
                top="0"
                rows="auto, auto, auto, auto, auto, auto" 
                columns="auto, *, *, *, *, *"
                padding="10">
                <!-- Row 0 - Filter Criteria -->
                <Label 
                    [text]="filterCriteria"
                    color="#fff"
                    [visibility]="showFilterCriteria ? 'visible' : 'collapsed'"
                    textWrap="true"
                    row="0"
                    col="0"
                    (tap)="onfilterCriteriaTap()"
                    colSpan="6"
                    textWrap="true"></Label>
                <!-- Row 1 - Search Text -->
                <TextField 
                    #search
                    row="1"
                    col="0"
                    colSpan="6"
                    padding="10"
                    margin="10"
                    hint="&#xf002; Search"
                    style="placeholder-color: {{ theme.lightGrey }}; border-bottom-color: {{ theme.lightGrey }};"
                    class="font-awesome"
                    alignSelf="center"
                    (textChange)="onSearchTextChange($event)"
                    [color]="theme.accentColor"></TextField>
                <!-- Row 2-3 -->
                <Label 
                    row="2"
                    col="0"
                    fontSize="20"
                    [color]="theme.inactiveColor"
                    text="Distance: "></Label>
                <Label 
                    row="2"
                    col="1"
                    colSpan="2"
                    alignSelf="center">
                    <FormattedString>
                        <Span
                            [text]="distance"
                            [color]="theme.accentColor"
                            fontSize="20"
                            padding="10"
                            alignSelf="center"
                            fontWeight="700"></Span>
                        <Span
                            text=" miles"
                            textWrap="true"
                            fontSize="16"
                            [color]="theme.inactiveColor"></Span>
                    </FormattedString>
                </Label>
                <!-- Row 4 -->
                <Slider 
                    #distanceSlider
                    row="4"
                    col="0"
                    colSpan="6"
                    minValue="1"
                    maxValue="48280.3"
                    margin="20 0 20 0"
                    [value]="setDistanceSliderValue()"
                    [backgroundColor]="theme.lightGrey"
                    (valueChange)="onDistanceSliderChange($event)"></Slider>
                <!-- Row 5 -->
                <FlexboxLayout 
                    row="5"
                    col="0"
                    colSpan="6"
                    flexDirection="row"
                    alignContent="center">
                    <Label 
                        text="Distance"
                        fontSize="20"
                        padding="10"
                        alignSelf="center" 
                        [color]="theme.inactiveColor"></Label>
                    <Switch [checked]="distPop == 'Distance'"></Switch>
                    <Label 
                        text="Poplarity" 
                        fontSize="20"
                        padding="10"
                        alignSelf="center"
                        [color]="theme.inactiveColor"></Label>
                    <Switch [checked]="distPop == 'Popularity'"></Switch>
                </FlexboxLayout>
            </GridLayout>
        </ScrollView>
        <!-- Bottom Button Array -->
        <FlexboxLayout
            row="1"
            col="0"
            colSpan="3"
            width="100%"
            height="100%"
            minHeight="100%"
            flexDirection="row"
            alignItems="center">
            
            <!-- Cancel Button -->
            <Button  
                row="1"
                col="0"
                width="50%"
                minHeight="50%"
                text="Cancel"
                alignSelf="center"
                [color]="theme.inactiveColor"
                [backgroundColor]="theme.darkGrey"
                (tap)="onCancelTap()"
                class="btn btn-secondary"></Button>
            <!-- Reset Button -->
            <Button
                row="1"
                col="1"
                width="50%"
                minHeight="50%%"
                text="Reset"
                alignSelf="center"
                class="btn btn-outline-custom"
                (tap)="onResetTap()"></Button>
            <!-- Search Button -->
            <Button
                row="1"
                col="2"
                width="50%"
                minHeight="50%"
                text="&#xf002; Search"
                alignSelf="center"        
                [color]="theme.inactiveColor"                      
                class="btn btn-primary font-awesome"
                (tap)="onSearchTap()"></Button>
        </FlexboxLayout>
    </GridLayout>
    <ActivityIndicator 
        left="50%"
        top="50%"
        busy="true" 
        width="100" 
        height="100" 
        alignSelf="center"
        [color]="theme.accentColor"
        [visibility]="filterSearchBtnProgress ? 'visible' : 'collapsed'"
        class="activity-indicator"></ActivityIndicator>
</AbsoluteLayout>

<!-- OK Display -->
<RadListView 
    #vendorList
    [visibility]="(searchStatusCode == 'OK') ? 'visible' : 'collapsed'"
    [backgroundColor]="theme.primaryColor"
    [items]="vendors" 
    pullToRefresh="true" 
    [color]="theme.accentColor"
    (pullToRefreshInitiated)="refresh($event, 1)" 
    selectionBehavior="Press"
    (itemSelected)="onVendorTap($event)"
    multileSelection="false"
    loadOnDemandMode="Manual"
    (loadMoreDataRequested)="onLoadMoreItemsRequested($event)">
    <ng-template let-vendor="item" let-i="index">
        <vendor-listing [vendor]="vendor" [index]="index"></vendor-listing>
    </ng-template>
</RadListView>







